import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.net.URL;
import javax.crypto.Cipher;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;

public class Decrypt {
    static int counter=0;
    public Decrypt(){

    }
    public static void main(String[] args) throws Exception{
        // Read the files with readFile method 
        URL url1=Decrypt.class.getResource("key.dat");
        String Path1 = url1.getPath();//path of file to read it
        byte [] keybyte= readFile(Path1);//put the content of file in array of bytes
        SecretKey key = new SecretKeySpec(keybyte,0,keybyte.length,"AES");
        // Object to create key that's take key of bytes  and use AES algorthm
        
        URL url2= Decrypt.class.getResource("Ciphertext.dat");
        String Path2= url2.getPath();//path of file to read it
        byte [] encryptedbyte= readFile(Path2);//put the content of file in array of bytes
        
        String plain =decryptFile(key,encryptedbyte);//decrypt the file 
        System.out.println("Plain text: "+plain);
        writePlain("plain.dat",plain);
    }
    public static byte[] readFile(String Path)throws Exception{
        File file=new File(Path);
        byte fileContent[]=new byte[(int)file.length()];
        FileInputStream f=null;
        try{
            f = new FileInputStream(file);//creat the object
            f.read(fileContent);// read the file and put it in the array
           
            String s=new String(fileContent);//convert it to string 
            if(counter==0){
                System.out.println("Key content: "+s);//print key file
                counter++;
            }
            else{
                System.out.println("File Encrypted content: "+s);//print ciphertext file
                counter--;
            }
        }
        catch(FileNotFoundException e){
            System.out.print("File not found"+e);
        }
        catch(IOException ioe){
            System.out.print("Exception while reading file"+ioe);
        }
        //colse the file
        finally{
            try{
                if(f !=null){// Exception has not occurred
                    f.close();
                }
            }
            catch(IOException ioe){
                System.out.print("Error while closing stream: "+ioe);
            }
        }
        return fileContent;
    }
    public static String decryptFile(SecretKey key, byte[] encryptedbyte) throws Exception{
        Cipher aesCipher=Cipher.getInstance("AES/ECB/NOPadding");//class cipher that's deal with ECB
        aesCipher.init(Cipher.DECRYPT_MODE, key);//init the object aesCipher of type DECRYPT MODE and the key
        byte[] bytePlainText= aesCipher.doFinal(encryptedbyte);//start the Decrypt in put the result in array of bytes
        return new String(bytePlainText);//convert it to string
    }
    public static void writePlain(String path , String plain)throws IOException{
        BufferedWriter B=new BufferedWriter(new FileWriter(path));//use class BufferedWriter to Write in file
        B.write(plain);//write the plain in the file
        B.close();
    }  
}
